#!/bin/bash

key_file=$2
code=$(cat $key_file)
code_upper=$(echo $code | tr "a-z" "A-Z")
code_lower=$(echo $code | tr "A-Z" "a-z")
code="$code_upper$code_lower"

function crypt(){
    exit=$(cat "$1" | tr "A-Za-z" "$code")
    echo $exit 
}

function decrypt(){
    exit=$(cat $1 | tr $code "A-Za-z")
    echo $exit
}


while read line;
    line_encrypted=$(crypt "$line")
    echo line_encrypted | nc target $1 12345
    encrypted_output=$(nc -l $1 12345)
    echo "$(decrypt $encrypted_output)"